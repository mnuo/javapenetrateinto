5 性能调优
##### 1 CPU消耗分析
+ 上下文切换:
> 每个CPU在同一时间只能执行一个线程,Linux采用的是抢占式调度,即为每个线程分配一定的执行时间,当到达执行时间,线程中有IO阻塞或高优先级线程要执行时,Linux将切换执行的线程,在切换时要存储目前线程的执行状态,并恢复要执行的线程的状态,这个过程就称为上下文切换.对于Java应用,典型的是在进行文件IO操作,网络IO操作,所等待或线程Sleep时,当前线程会进入阻塞或休眠状态,从而触发上下文切换,上下文切换过多会造成内核占据较多的CPU使用,使得应用的响应速度下降
+ 运行队列
> 每个cpu都维护了一个可运行的线程队列,例如一个4核的CPU,JAVA应用中启动了8个线程,且这8个线程都处于可运行状态,那么在分配平均的情况下,每个CPU中运行队列里就会有两个线程.通常而言,系统的load主要由CPU的运行队列来决定,假设以上状况维持了1分钟,那么着1分钟内系统的load就会是2,但由于load是个复杂的值,因此也绝不是绝对的,运行队列值越大,就意味着线程会要消耗越长的时间才能执行完
+ 利用率
> CPU利用率为CPU在用户进程,内核,中断处理,IO等待以及空闲5个部分使用百分比,这5个值是用来分析CPU消耗情况的关键指标,建议用户进程的CPU消耗/内核的CPU消耗比率在65%-70%/30%-35%
	- top 其中4.0% 表示用户进程处理所占的百分比;8.9% sy表示为内核线程处理所占的百分比;ni表示内nice命令改变优先级的任务所占的百分;id表示CPU的空闲时间所占的百分比;wa表示为在执行的过程中等待IO所占的百分比;hi表示为硬件中断所占的百分比;si表示为软件中断所占的百分比
	- pidstat 是sysstat中的工具,如需使用pidstat 先安装sysstat
	通过pidstat 找到 tid 转成16进制,使用jstack pid | grep 'nid=0x...' 找到线程